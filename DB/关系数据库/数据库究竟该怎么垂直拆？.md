# 目录

[toc]

---

[转载！出处](https://blog.csdn.net/shenjian58/article/details/106580833)


缘起上周，有水友问我说：

**都知道业务垂直拆分，数据库要怎么垂直拆分呢？**

今天，简单聊聊数据库垂直拆分。

# 什么是数据库水平切分，垂直拆分？

当 **数据库的数据量非常大时**，水平切分和垂直拆分都是常见的降低库空间，提升库性能的方法。

太抽象，能不能举个例子？

假设有用户表：
```sql
user(
    uid bigint,
    name varchar(16),
    pass varchar(16),
    age int,
    sex tinyint,
    flag tinyint,
    sign varchar(64),
    intro varchar(256)
    …
);
```

## 什么是水平切分？

以某个字段为依据（例如uid），按照一定规则（例如取模），
**<u>将一个库（表）上的数据拆分到多个库（表）中</u>**，
以降低单库（表）大小，达到提升性能的目的的方法。

**水平切分后，各个库（表）有什么特点？**
（1）每个库（表）的结构都一样；
（2）每个库（表）的数据都不一样，没有交集；
（3）所有库（表）的并集是全量数据；

<br>

## 什么是垂直拆分？

将一个 **属性较多，一行数据较大** 的表，
将 **<u>不同的属性拆分到不同的库（表）中</u>**，以降低单库（表）大小，达到提升性能的目的的方法。

垂直拆分后，各个库（表）有什么特点？

（1）每个库（表）的结构都不一样；
（2）每个库（表）的属性至少有一列交集，一般是主键；
（3）**所有库（表）的并集是全量数据**；

以上文提到的用户表为例，垂直拆分结果可能是这样的：

```sql
user_base(
    uid bigint,
    name varchar(16),
    pass varchar(16),
    age int,
    sex tinyint,
    flag tinyint,
    …
);

user_ext(
    uid bigint,
    sign varchar(64),
    intro varchar(256)
    …
);
```

# 当一个表属性很多时，如何来进行垂直拆分呢？

主要依据以下几点：

（1）将 **<u>长度较短，访问频率较高</u>** 的属性尽量放在一个表里，这个表暂且称为 **<u>主表</u>**；
（2）将 **<u>字段较长，访问频率较低</u>** 的属性尽量放在一个表里，这个表暂且称为 **<u>扩展表</u>**；
（3）经常一起访问的属性，也可以放在一个表里；

画外音：
优先考虑 1 和 2。
如果属性过多，可以有多个扩展表。
一般来说，只有1个主表。


<u></u>
**<u></u>**
**====**
 

## 为何要将字段短，访问频率高的属性放到一个表内？

为何这么垂直拆分可以提升性能？

（1）数据库有自己的内存缓冲池，会将磁盘上的数据 load 到缓冲池里；
(详见《数据库缓冲池，这次彻底懂了！》)
（2）数据库缓冲池，**==以 row 为单位==** 缓存数据；
（3）在内存有限的情况下，在数据库缓冲池里缓存 **==短 row，就能缓存更多的数据==**；
（4）在数据库缓冲池里缓存高频访问 row，就能提升缓存命中率，减少磁盘的访问；

 
**举个例子：**

假设数据库内存缓冲池为 1G ，未拆分的 user 表 1 行数据大小为 1k ，那么只能缓存 100w 行数据。
如果垂直拆分成 **`user_base`** 和 **`user_ext`** ，其中：
（ 1 ） `user_base` 访问频率高，一行大小为 0.1k ；（例如 uid, name, passwd, 以及一些 flag 等）
（ 2 ） `user_ext` 访问频率低，一行大小为 0.9k ；（例如签名 , 个人介绍等）

那边缓冲池就就能缓存近乎 1000w 行 `user_base` 的记录，
访问磁盘的概率会大大降低，数据库访问的时延会大大降低，吞吐量会大大增加。

 

# 总结

（1）水平拆分和垂直拆分都是降低数据量大小，提升数据库性能的常见手段；
（2）垂直拆分的依据，尽量把长度较短，访问频率较高的属性放在主表里；
————————————————
版权声明：本文为CSDN博主「58沈剑」的原创文章，遵循CC 4.0 BY-SA版权协议，转载请附上原文出处链接及本声明。
原文链接：https://blog.csdn.net/shenjian58/article/details/106580833